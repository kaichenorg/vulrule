"use strict";(self.webpackChunkvulrule_docusaurus=self.webpackChunkvulrule_docusaurus||[]).push([[15980],{64383:(s,e,n)=>{n.r(e),n.d(e,{default:()=>S});var i=n(96540),r=n(51410),a=n(12631);const c={adminContainer:"adminContainer_k8Ly",error:"error_QFH1",message:"message_Q7Up",infoBox:"infoBox_KGMo",loading:"loading_uR78",noRequests:"noRequests_bgPw",noAccess:"noAccess_FEyP",userList:"userList_nmvu",actions:"actions_dHp6",approveButton:"approveButton_FCqu",rejectButton:"rejectButton_od0_"};var d=n(74848);const t=()=>{const{currentUser:s,isAdmin:e,getPendingUsers:n,approveUser:r}=(0,a.A)(),[t,l]=(0,i.useState)([]),[o,h]=(0,i.useState)(!0),[j,x]=(0,i.useState)(""),[m,u]=(0,i.useState)("");(0,i.useEffect)((()=>{if(!e||!s)return;(async()=>{try{h(!0),x("");const s=await n();l(s)}catch(s){console.error("\u83b7\u53d6\u5f85\u5ba1\u6279\u7528\u6237\u5931\u8d25:",s),x(s.message||"\u83b7\u53d6\u5f85\u5ba1\u6279\u7528\u6237\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5")}finally{h(!1)}})()}),[s,e,n]);const N=async(n,i)=>{if(e&&s)try{h(!0),x(""),u(""),await r(n,i),l(t.filter((s=>s.id!==n))),u(`\u5df2${i?"\u6279\u51c6":"\u62d2\u7edd"}\u7528\u6237\u6ce8\u518c\u8bf7\u6c42`),i&&u((s=>`${s} \u7531\u4e8e\u4f7f\u7528\u514d\u8d39\u7248Firebase\uff0c\u7cfb\u7edf\u65e0\u6cd5\u81ea\u52a8\u53d1\u9001\u901a\u77e5\u90ae\u4ef6\u3002\u8bf7\u901a\u77e5\u7528\u6237\u5176\u8d26\u53f7\u5df2\u83b7\u6279\u51c6\u3002`))}catch(a){console.error("\u5904\u7406\u5ba1\u6279\u5931\u8d25:",a),x(a.message||"\u5904\u7406\u5ba1\u6279\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5")}finally{h(!1)}else x("\u60a8\u6ca1\u6709\u6743\u9650\u6267\u884c\u6b64\u64cd\u4f5c")};return e?(0,d.jsx)("div",{className:c.adminContainer,children:(0,d.jsxs)("div",{className:c.userManagementContainer,children:[(0,d.jsx)("h2",{children:"\u7528\u6237\u6ce8\u518c\u5ba1\u6279"}),j&&(0,d.jsx)("div",{className:c.error,children:j}),m&&(0,d.jsx)("div",{className:c.message,children:m}),(0,d.jsx)("div",{className:c.infoBox,children:(0,d.jsxs)("p",{children:[(0,d.jsx)("strong",{children:"\u63d0\u793a\uff1a"}),"\u7531\u4e8e\u4f7f\u7528Firebase\u514d\u8d39\u8ba1\u5212\uff0c\u7cfb\u7edf\u65e0\u6cd5\u53d1\u9001\u81ea\u52a8\u90ae\u4ef6\u901a\u77e5\u3002\u6279\u51c6/\u62d2\u7edd\u7528\u6237\u540e\uff0c\u8bf7\u901a\u8fc7\u5176\u4ed6\u65b9\u5f0f\u901a\u77e5\u7528\u6237\u3002"]})}),o?(0,d.jsx)("div",{className:c.loading,children:"\u52a0\u8f7d\u4e2d..."}):0===t.length?(0,d.jsx)("div",{className:c.noRequests,children:"\u5f53\u524d\u6ca1\u6709\u5f85\u5ba1\u6279\u7684\u6ce8\u518c\u8bf7\u6c42"}):(0,d.jsx)("div",{className:c.userList,children:(0,d.jsxs)("table",{children:[(0,d.jsx)("thead",{children:(0,d.jsxs)("tr",{children:[(0,d.jsx)("th",{children:"\u90ae\u7bb1"}),(0,d.jsx)("th",{children:"\u6240\u5c5e\u5355\u4f4d"}),(0,d.jsx)("th",{children:"\u6ce8\u518c\u65f6\u95f4"}),(0,d.jsx)("th",{children:"\u64cd\u4f5c"})]})}),(0,d.jsx)("tbody",{children:t.map((s=>(0,d.jsxs)("tr",{children:[(0,d.jsx)("td",{children:s.email}),(0,d.jsx)("td",{children:s.organization}),(0,d.jsx)("td",{children:s.registeredAt.toLocaleString()}),(0,d.jsxs)("td",{className:c.actions,children:[(0,d.jsx)("button",{onClick:()=>N(s.id,!0),className:c.approveButton,disabled:o,children:"\u6279\u51c6"}),(0,d.jsx)("button",{onClick:()=>N(s.id,!1),className:c.rejectButton,disabled:o,children:"\u62d2\u7edd"})]})]},s.id)))})]})})]})}):(0,d.jsx)("div",{className:c.noAccess,children:"\u60a8\u6ca1\u6709\u8bbf\u95ee\u6b64\u9875\u9762\u7684\u6743\u9650\u3002"})},l="adminContainer_yUsr",o="error_FE3T",h="message_O38N",j="infoBox_tJoh",x="loading_plO5",m="noAccess_xHsL",u="userList_qVYE",N="actions_EGkg",v="noUsers_RDm2",g="statusApproved_Yk7Y",p="statusPending_nj96",_="statusRejected_da1L",f="adminBadge_XRpQ",A="nonAdminBadge_nH9d",y="grantButton_aQu2",b="revokeButton_lXr1",B=()=>{const{currentUser:s,isAdmin:e,getAllUsers:n,setUserAdminStatus:r}=(0,a.A)(),[c,t]=(0,i.useState)([]),[B,S]=(0,i.useState)(!0),[k,C]=(0,i.useState)(""),[w,L]=(0,i.useState)(""),[U,F]=(0,i.useState)(null);(0,i.useEffect)((()=>{if(!e||!s)return;(async()=>{try{S(!0),C("");const s=await n();t(s)}catch(s){console.error("\u83b7\u53d6\u7528\u6237\u5217\u8868\u5931\u8d25:",s),C(s.message||"\u83b7\u53d6\u7528\u6237\u5217\u8868\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5")}finally{S(!1)}})()}),[s,e,n]);const R=s=>{switch(s){case"approved":return(0,d.jsx)("span",{className:g,children:"\u5df2\u6279\u51c6"});case"pending":return(0,d.jsx)("span",{className:p,children:"\u5f85\u5ba1\u6279"});case"rejected":return(0,d.jsx)("span",{className:_,children:"\u5df2\u62d2\u7edd"});default:return(0,d.jsx)("span",{children:s})}};return e?(0,d.jsxs)("div",{className:l,children:[(0,d.jsx)("h2",{children:"\u7528\u6237\u7ba1\u7406"}),k&&(0,d.jsx)("div",{className:o,children:k}),w&&(0,d.jsx)("div",{className:h,children:w}),(0,d.jsx)("div",{className:j,children:(0,d.jsxs)("p",{children:[(0,d.jsx)("strong",{children:"\u63d0\u793a\uff1a"}),"\u6b64\u9875\u9762\u663e\u793a\u6240\u6709\u7528\u6237\u53ca\u5176\u72b6\u6001\u3002\u60a8\u53ef\u4ee5\u5c06\u5176\u4ed6\u5df2\u6279\u51c6\u7684\u7528\u6237\u8bbe\u4e3a\u7ba1\u7406\u5458\u3002"]})}),B?(0,d.jsxs)("div",{className:x,children:[(0,d.jsx)("div",{className:"loading-spinner"}),"\u52a0\u8f7d\u4e2d..."]}):0===c.length?(0,d.jsx)("div",{className:v,children:"\u5f53\u524d\u7cfb\u7edf\u4e2d\u6ca1\u6709\u7528\u6237"}):(0,d.jsx)("div",{className:u,children:(0,d.jsx)("div",{className:"table-container",children:(0,d.jsxs)("table",{children:[(0,d.jsx)("thead",{children:(0,d.jsxs)("tr",{children:[(0,d.jsx)("th",{children:"\u90ae\u7bb1"}),(0,d.jsx)("th",{children:"\u6240\u5c5e\u5355\u4f4d"}),(0,d.jsx)("th",{children:"\u72b6\u6001"}),(0,d.jsx)("th",{children:"\u6ce8\u518c\u65f6\u95f4"}),(0,d.jsx)("th",{children:"\u7ba1\u7406\u5458"}),(0,d.jsx)("th",{children:"\u64cd\u4f5c"})]})}),(0,d.jsx)("tbody",{children:c.map((n=>(0,d.jsxs)("tr",{children:[(0,d.jsx)("td",{children:(0,d.jsx)("strong",{children:n.email})}),(0,d.jsx)("td",{children:n.organization}),(0,d.jsx)("td",{children:R(n.approvalStatus)}),(0,d.jsx)("td",{children:n.registeredAt.toLocaleString()}),(0,d.jsx)("td",{children:n.isAdmin?(0,d.jsx)("span",{className:f,children:"\u662f"}):(0,d.jsx)("span",{className:A,children:"\u5426"})}),(0,d.jsx)("td",{className:N,children:(0,d.jsx)("button",{onClick:()=>(async(n,i)=>{if(e&&s)if(n===s.uid&&i)C("\u65e0\u6cd5\u64a4\u9500\u81ea\u5df1\u7684\u7ba1\u7406\u5458\u6743\u9650");else try{F(n),C(""),L("");const s=!i;await r(n,s),t((e=>e.map((e=>e.id===n?{...e,isAdmin:s}:e)))),L(`\u5df2${s?"\u6388\u4e88":"\u64a4\u9500"}\u7528\u6237\u7ba1\u7406\u5458\u6743\u9650`)}catch(a){console.error("\u5904\u7406\u7ba1\u7406\u5458\u6743\u9650\u53d8\u66f4\u5931\u8d25:",a),C(a.message||"\u5904\u7406\u7ba1\u7406\u5458\u6743\u9650\u53d8\u66f4\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5")}finally{F(null)}else C("\u60a8\u6ca1\u6709\u6743\u9650\u6267\u884c\u6b64\u64cd\u4f5c")})(n.id,n.isAdmin),className:n.isAdmin?b:y,disabled:B||U===n.id||n.id===s?.uid&&n.isAdmin,title:n.id===s?.uid&&n.isAdmin?"\u65e0\u6cd5\u64a4\u9500\u81ea\u5df1\u7684\u7ba1\u7406\u5458\u6743\u9650":"",children:U===n.id?"\u5904\u7406\u4e2d...":n.isAdmin?"\u64a4\u9500\u7ba1\u7406\u5458":"\u8bbe\u4e3a\u7ba1\u7406\u5458"})})]},n.id)))})]})})})]}):(0,d.jsx)("div",{className:m,children:"\u60a8\u6ca1\u6709\u8bbf\u95ee\u6b64\u9875\u9762\u7684\u6743\u9650\u3002"})};function S(){const{isAdmin:s}=(0,a.A)();return(0,d.jsx)(r.A,{title:"\u7ba1\u7406\u5458\u63a7\u5236\u9762\u677f",description:"\u7528\u6237\u6ce8\u518c\u5ba1\u6279\u548c\u7cfb\u7edf\u7ba1\u7406\u529f\u80fd",children:s?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("header",{className:"hero hero--primary",children:(0,d.jsxs)("div",{className:"container",children:[(0,d.jsx)("h1",{className:"hero__title",children:"\u7ba1\u7406\u5458\u63a7\u5236\u9762\u677f"}),(0,d.jsx)("p",{className:"hero__subtitle",children:"\u7ba1\u7406\u7528\u6237\u6ce8\u518c\u8bf7\u6c42\u548c\u7cfb\u7edf\u8bbe\u7f6e"})]})}),(0,d.jsxs)("main",{className:"container margin-vert--lg",children:[(0,d.jsx)(t,{}),(0,d.jsx)(B,{})]})]}):(0,d.jsx)("main",{className:"container margin-vert--xl",children:(0,d.jsx)("div",{className:"row",children:(0,d.jsx)("div",{className:"col col--6 col--offset-3",children:(0,d.jsxs)("div",{className:"card",children:[(0,d.jsx)("div",{className:"card__header",children:(0,d.jsx)("h2",{children:"\u8bbf\u95ee\u53d7\u9650"})}),(0,d.jsx)("div",{className:"card__body",children:(0,d.jsx)("p",{children:"\u60a8\u6ca1\u6709\u6743\u9650\u8bbf\u95ee\u6b64\u9875\u9762\u3002\u8be5\u9875\u9762\u4ec5\u4f9b\u7cfb\u7edf\u7ba1\u7406\u5458\u4f7f\u7528\u3002"})})]})})})})})}}}]);